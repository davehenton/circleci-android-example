machine:
 environment:
  ANDROID_HOME: /home/ubuntu/android
  INFER_HOME: ~/.infer/infer-linux64-v0.9.2/infer
dependencies:
 cache_directories:
    - ~/.android
    - ~/android
    - ~/.infer
 pre:
    - chmod +x scripts/install-infer.sh
    - ./scripts/install-infer.sh
 override:
   - chmod +x scripts/install-dependencies.sh
   - ./scripts/install-dependencies.sh
test:
  override:
    - ./gradlew assembleDebug
    - ./gradlew jacocoTestReport
    # run infer
    - ./gradlew clean
    - infer -i -- ./gradlew build
  post:
    - cp -r app/build/outputs $CIRCLE_ARTIFACTS
    - cp -r app/build/reports $CIRCLE_ARTIFACTS
    - cp -r app/infer-out $CIRCLE_ARTIFACTS